buffer: 16
srid: 3857
layers:
- name: places
  buffer: 128
  queries:
    - maxzoom: 4
      sql: |-
        SELECT
          name, type, name, osm_id, geometry AS way
        FROM
          osm_places
        WHERE
          name IS NOT NULL
          AND type IN ('continent','ocean','country')
        ORDER BY
          z_order ASC
    - minzoom: 5
      maxzoom: 13
      sql: |-
        SELECT
          name, type, name, osm_id, geometry AS way
        FROM
          osm_places
        WHERE
          name IS NOT NULL
          AND type IN ('city','county','province','island','town','lake','village')
        ORDER BY
          z_order ASC
    - minzoom: 14
      maxzoom: 22
      sql: |-
        SELECT
          name, type, name, osm_id, geometry AS way
        FROM
          osm_places
        WHERE
          name IS NOT NULL
          AND type IN ('city','county','province','island','town','neighbourhood','suburb','locality','lake','village','hamlet','isolated_dwelling')
        ORDER BY
          z_order ASC
- name: railways
  clip: true
  buffer: 8
  queries:
    - maxzoom: 8
      sql: |-
        SELECT
          ST_SimplifyPreserveTopology(ST_LineMerge(ST_Collect(geometry)),!pixel_width!) AS way,
          type, name, tunnel, bridge, oneway, ref, service, highspeed, class
        FROM
          osm_railways_gen0
        WHERE
          geometry && !bbox! and type='rail' and coalesce(service,'') in ('','main')
        GROUP BY
          z_order, type, name, tunnel, bridge, oneway, ref, service, highspeed, class
         ORDER BY
          z_order, highspeed DESC
    - minzoom: 9
      maxzoom: 11
      sql: |-
        SELECT
          ST_SimplifyPreserveTopology(ST_LineMerge(ST_Collect(geometry)),!pixel_width!) AS way,
          type, name, tunnel, bridge, oneway, ref, service, highspeed, class
        FROM
          osm_railways_gen1
        WHERE
          geometry && !bbox! and type in ('rail','subway') and coalesce(service,'') in ('','main')
        GROUP BY
          z_order, type, name, tunnel, bridge, oneway, ref, service, highspeed, class
        ORDER BY
          z_order, highspeed DESC, coalesce(service,'') DESC
    - minzoom: 12
      maxzoom: 20
      sql: |-
        SELECT
          geometry AS way,
          type, name, tunnel, bridge, oneway, ref, service, highspeed, class
        FROM
          osm_railways
        ORDER BY
          z_order, highspeed DESC, coalesce(service,'') DESC
- name: roads
  clip: true
  queries:
    - maxzoom: 9
      sql: |-
        SELECT
          geometry AS way, type, name, tunnel, bridge,
          (CASE WHEN type IN ('motorway', 'motorway_link') THEN 'highway'
                WHEN type IN ('trunk', 'trunk_link', 'secondary', 'primary') THEN 'major_road'
                ELSE 'minor_road' END) AS category,
          (CASE WHEN type LIKE '%_link' THEN 1
                ELSE 0 END) AS link
        FROM
          osm_roads_gen0
        ORDER BY
          z_order ASC
    - minzoom: 10
      maxzoom: 12
      sql: |-
        SELECT
          geometry AS way, type, name, tunnel, bridge,
          (CASE WHEN type IN ('motorway', 'motorway_link') THEN 'highway'
                WHEN type IN ('trunk', 'trunk_link', 'secondary', 'primary') THEN 'major_road'
                ELSE 'minor_road' END) AS category,
          (CASE WHEN type LIKE '%_link' THEN 1
                ELSE 0 END) AS link
        FROM
          osm_roads_gen1
        ORDER BY
          z_order ASC
    - minzoom: 13
      maxzoom: 20
      sql: |-
        SELECT
          geometry AS way, type, name, tunnel, bridge, osm_id,
          (CASE WHEN type IN ('motorway', 'motorway_link') THEN 'highway'
                WHEN type IN ('trunk', 'trunk_link', 'primary', 'primary_link', 'secondary', 'secondary_link', 'tertiary', 'tertiary_link') THEN 'major_road'
                WHEN type IN ('footpath', 'track', 'footway', 'steps', 'pedestrian', 'path', 'cycleway') THEN 'path'
                ELSE 'minor_road' END) AS category,
          (CASE WHEN type LIKE '%_link' THEN 1
                ELSE 0 END) AS link
        FROM
          osm_roads
        ORDER BY
          z_order ASC
- name: places
  queries:
    - maxzoom: 7
      sql: |-
        SELECT
          name, type
        FROM
          osm_places
        WHERE
          name IS NOT NULL
          AND place IN ('city','county','province','island','town','lake')
        ORDER BY
          population DESC
- name: landuse
  clip: true
  buffer: 8
  queries:
    - maxzoom: 9
      sql: |-
        SELECT
          ST_SimplifyPreserveTopology(geometry,!pixel_width!) AS way, type, name
        FROM
          osm_landusages_gen0
        WHERE
          geometry && !bbox! and area>(!pixel_width!*!pixel_width!)
        ORDER BY
          z_order DESC, area DESC
    - minzoom: 10
      maxzoom: 12
      sql: |-
        SELECT
          geometry AS way, type, name
        FROM
          osm_landusages_gen1
        ORDER BY
          z_order DESC, area DESC
    - minzoom: 13
      maxzoom: 20
      sql: |-
        SELECT
          geometry AS way, type, name
        FROM
          osm_landusages
        ORDER BY
          z_order DESC, area DESC
- name: waterarea
  clip: true
  buffer: 8
  queries:
    - maxzoom: 9
      sql: |-
        SELECT
          ST_SimplifyPreserveTopology(geometry,!pixel_width!) AS way, type, name
        FROM
          osm_waterareas_gen0
        WHERE
          geometry && !bbox! and area>(!pixel_width!*!pixel_width!)
        ORDER BY
          area DESC
    - minzoom: 10
      maxzoom: 12
      sql: |-
        SELECT
          geometry AS way, type, name
        FROM
          osm_waterareas_gen1
        ORDER BY
          area DESC
    - minzoom: 13
      maxzoom: 20
      sql: |-
        SELECT
          geometry AS way, type, name
        FROM
          osm_waterareas
        ORDER BY
          area DESC
- name: waterway
  clip: true
  buffer: 8
  queries:
    - maxzoom: 9
      sql: |-
        SELECT
          ST_SimplifyPreserveTopology(geometry,!pixel_width!) AS way, type, name, tunnel, bridge
        FROM
          osm_waterways_gen0
        WHERE
          geometry && !bbox! and type in ('river','canal')
    - minzoom: 10
      maxzoom: 11
      sql: |-
        SELECT
          geometry AS way, type, name, tunnel, bridge
        FROM
          osm_waterways_gen1
        WHERE
           type in ('river','canal')
    - minzoom: 12
      maxzoom: 20
      sql: |-
        SELECT
          geometry AS way, type, name, tunnel, bridge
        FROM
          osm_waterways

